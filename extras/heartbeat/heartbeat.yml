###################### Heartbeat Configuration #######################

http.enabled: true
http.port: 5066
http.host: "0.0.0.0"
#http.host: "heart.nginx.local"

xpack.monitoring.enabled: true
monitoring:
  enabled: false
  cluster_uuid: "${CLUSTER_UUID}"

heartbeat.config.monitors:
  # Directory + glob pattern to search for configuration files
  path: ${path.config}/monitors.d/*.yml
  # If enabled, heartbeat will periodically check the config.monitors path for changes
  reload.enabled: false
  # How often to check for changes
  reload.period: 15s

heartbeat.monitors:
- type: http
  schedule: '0 * * * * * *'
  id: http-traefik-service
  name: HTTP Service
  data_stream.namespace: default
  service.name: heartbeat-http
  check.response.status: [302]
  hosts:
    # traefik
    - https://${APP_HOST}.traefik.local:443
    - https://www.traefik.local:443
  ssl:
    certificate_authorities: ['${ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES}']
    verification_mode: "none"
    # verification_mode: "certificate"

- type: http
  schedule: '0 * * * * * *'
  id: http-fleet-service
  name: HTTP Service
  data_stream.namespace: default
  service.name: heartbeat-http
  check.response.status: [404]
  hosts:
    # wordpress
    - https://fleet.${APP_HOST}.wordpress.local:8220
    # tomcat
    - https://fleet.${APP_HOST}.tomcat.local:8220
  ssl:
    certificate_authorities: ['${ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES}']
    verification_mode: "none"
    # verification_mode: "certificate"

- type: http
  schedule: '0 * * * * * *'
  id: http-service
  name: HTTP Service
  data_stream.namespace: default
  service.name: heartbeat-http
  username: '${ELASTICSEARCH_USERNAME}'
  password: '${ELASTICSEARCH_PASSWORD}'
  # api_key: ${AGENT_API_KEY}
  check.response.status: [200]
  hosts:
    # ELK
    - http://apm.${APP_NET}:8200
    - http://cerebro.${APP_HOST}.${APP_NET}:9000
    - https://es01.${APP_HOST}.${APP_NET}:9200
    - https://es02.${APP_HOST}.${APP_NET}:9201
    # - https://es03.${APP_HOST}.${APP_NET}:9202
    - https://${APP_HOST}.${APP_NET}:443/downloads/
    - https://kibana.${APP_HOST}.${APP_NET}:5601/status
    - https://wiki.${APP_HOST}.${APP_NET}/doku.php?id=wiki:welcome
    - http://apm.${APP_NET}:5066
    - http://metric.${APP_NET}:5066
    - http://file.${APP_NET}:5066
    - http://heart.${APP_NET}:5066
    # tomcat
    - https://tombola.${APP_HOST}.tomcat.local:8443/tomcat.jsp
    - https://${APP_HOST}.tomcat.local/tombola-javadoc/
    - https://ad.${APP_HOST}.tomcat.local
    - https://tombola.www.tomcat.local/tomcat.jsp
    - https://www.tomcat.local/tombola-javadoc/
    - https://ad.www.tomcat.local
    # wordpress
    - http://apm.wordpress.local:8200
    - https://${APP_HOST}.wordpress.local
    - https://pma.${APP_HOST}.wordpress.local
    # - https://www.wordpress.local
    # - https://pma.www.wordpress.local
    # intranet
    - https://lhs.intranet.local:443/downloads/
    - https://mamka.intranet.local:443/downloads/
  ssl:
    certificate_authorities: ['${ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES}']
    verification_mode: "none"
    # verification_mode: "certificate"

- type: tcp
  schedule: '0 * * * * * *'
  id: tcp-service
  name: TCP Service
  data_stream.namespace: default
  service.name: heartbeat-tcp
  hosts:
    # - platypus-box_traefik_1.platypus-local-dev-network:80
    - apm.${APP_NET}:5066
    - apm.${APP_NET}:8200
    - metric.${APP_NET}:5066
    - file.${APP_NET}:5066
    - heart.${APP_NET}:5066
    - eps.${APP_NET}:3002
    - kibana.${APP_HOST}.${APP_NET}:5601
    - logstash.${APP_HOST}.${APP_NET}:5044
    #- logstash.${APP_HOST}.${APP_NET}:5055
    # wordpress
    # - apm.wordpress.local:8200
    # - fleet.${APP_HOST}.wordpress.local:8220

- type: icmp
  schedule: '0 * * * * * *'
  id: icmp-service
  name: ICMP Service
  data_stream.namespace: default
  service.name: heartbeat-icmp
  hosts:
    - ${APP_HOST}.${APP_NET}
    # - apm.${APP_NET}
    # - cerebro.${APP_HOST}.${APP_NET}
    # - es01.${APP_HOST}.${APP_NET}
    # - es02.${APP_HOST}.${APP_NET}
    # - es03.${APP_HOST}.${APP_NET}
    # - file.${APP_NET}
    # - heart.${APP_NET}
    # - kibana.${APP_HOST}.${APP_NET}
    # - logstash.${APP_HOST}.${APP_NET}
    # - metric.${APP_NET}
    - weblhs-php.${APP_NET}
    # - wiki.${APP_HOST}.${APP_NET}

heartbeat.scheduler:
  limit: 2
heartbeat.jobs:
  http:
    limit: 3
  browser:
    limit: 2    

processors:
  - add_host_metadata:
      when.not.contains.tags: forwarded
  - add_docker_metadata: ~
  - add_cloud_metadata: ~
  - add_kubernetes_metadata: ~

output:
  elasticsearch:
    hosts: 
      - "https://es01.${APP_HOST}.${APP_NET}:9200"
      - "https://es02.${APP_HOST}.${APP_NET}:9201"
      # - "https://es03.${APP_HOST}.${APP_NET}:9202"
    protocol: "https"
    username: '${ELASTICSEARCH_USERNAME}'
    password: '${ELASTICSEARCH_PASSWORD}'
    # api_key: ${AGENT_API_KEY}
    ssl:
      enabled: true
      certificate_authorities: ['${ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES}']
      verification_mode: "certificate"
   
setup:
  ilm.overwrite: true
  kibana:
    host: "https://kibana.${APP_HOST}.${APP_NET}:5601"
    username: '${ELASTICSEARCH_USERNAME}'
    password: '${ELASTICSEARCH_PASSWORD}'
    ssl:
      enabled: true
      certificate_authorities: ['${ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES}']
      verification_mode: "certificate"

  apm:
    enabled: true
    server_url: "http://apm.${APP_NET}:8200"
