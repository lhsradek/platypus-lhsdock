###################### Metricbeat Configuration #######################

http.enabled: true
http.port: 5066
http.host: "0.0.0.0"
# http.host: "metricbeat.nginx.local"

monitoring:
  enabled: false
  cluster_uuid: "${CLUSTER_UUID}"

  elasticsearch:
    username: "${ELASTICSEARCH_USERNAME}"
    password: "${ELASTICSEARCH_PASSWORD}"
    hosts:
      - "https://es01.${APP_HOST}.${APP_NET}:9200"
    protocol: "https"
    ssl.enabled: true
    ssl.certificate_authorities: ["${ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES}"]
    ssl.verification_mode: "certificate"

metricbeat.config.modules:
  path: ${path.config}/modules.d/*.yml
  reload.enabled: false

processors:
  - add_host_metadata:
      when.not.contains.tags: forwarded
  - add_docker_metadata: ~
  - add_cloud_metadata: ~
  - add_kubernetes_metadata: ~

# hostPid: true

inputs:
  - type: system/metrics
    data_stream.namespace: default
    use_output: default
    streams:
      - metricset: cpu
        data_stream.dataset: system.cpu
      - metricset: memory
        data_stream.dataset: system.memory
      - metricset: network
        data_stream.dataset: system.network
      - metricset: filesystem
        data_stream.dataset: system.filesystem

# ----------------------------- Elasticsearch Output ----------------------------

output.elasticsearch:
  # enabled: false  
  hosts:
    - "https://es01.${APP_HOST}.${APP_NET}:9200"
    # - "https://es02.${APP_HOST}.${APP_NET}:9201"
  protocol: "https"
  # Authentication credentials - either API key or username/password.
  # api_key: "${AGENT_API_KEY}"
  username: "${ELASTICSEARCH_USERNAME}"
  password: "${ELASTICSEARCH_PASSWORD}"
  ssl:
    enabled: true
    certificate_authorities: ["${ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES}"]
    verification_mode: "${VERIFICATION_MODE}"
  
# ------------------------------ Logstash Output -------------------------------

# output.logstash:
#   hosts: ["logstash.${APP_HOST}.${APP_NET}:5044"]
#   ssl:
#     certificate_authorities: ["${ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES}"]
#     certificate: "${LOGSTASH_SERVER_CERT}"
#     certificate: "${LOGSTASH_SERVER_CERT}"
#     key: "${LOGSTASH_SERVER_CERT_KEY}"
#     verification_mode: "none"

setup.ilm.overwrite: true 
setup:
  template.settings:
    index.number_of_shards: 1
    index.codec: best_compression
    # _source.enabled: false
  elasticsearch:
    hosts: 
      - "https://es01.${APP_HOST}.${APP_NET}:9200"
    # api_key: ${AGENT_API_KEY}
    protocol: "https"
    username: "${ELASTICSEARCH_USERNAME}"
    password: "${ELASTICSEARCH_PASSWORD}"
    ssl:
      enabled: true
      certificate_authorities: ["${ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES}"]
      verification_mode: "${VERIFICATION_MODE}"
  kibana:
    host: "https://kibana.${APP_HOST}.${APP_NET}:5601"
    # api_key: ${AGENT_API_KEY}
    username: "${ELASTICSEARCH_USERNAME}"
    password: "${ELASTICSEARCH_PASSWORD}"
    ssl:
      enabled: true
      certificate_authorities: ["${ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES}"]
      verification_mode: "${VERIFICATION_MODE}"
