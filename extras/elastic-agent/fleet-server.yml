# Enables the stats endpoint under http://localhost:5601 by default.
# Additional stats can be found under http://127.0.0.1:5066/stats and http://127.0.0.1:5066/state
http.enabled: true
http.host: 0.0.0.0
http.port: 5066
#http.named_pipe.user:
#http.named_pipe.security_descriptor:

logging:
  to_stderr: true # Force the logging output to stderr
  #level: trace

fleet:
  hosts:
    - 'https://fleet.${APP_NET}:8220'
  agent:
    id: 1e4954ce-af37-4731-9f4a-407b08e69e42
    logging:
      level: '${LOG_LEVEL:DEBUG}'

inputs:
  - type: fleet-server
    server:
      host: fleet.${APP_NET}
      port: 8220
      timeouts:
        checkin_long_poll: 300s # long poll timeout
      instrumentation:
        enabled: false
        hosts: ["apm.${APP_NET}:8200"]
      profiler:
        enabled: true # enable profiler
      limits:
        policy_throttle: 100ms
        max_connetions: 150
          checkin_limit:
            interval: 100ms
            burst: 25
            max: 100
          artifact_limit:
            interval: 10ms
            burst: 5
            max: 10
          ack_limit:
            interval: 10ms
            burst: 20
            max: 10
          enroll_limit:
            interval: 50ms
            burst: 10
            max: 8
        ssl:
          enabled: true
          certificate_authorities: ["${ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES}"]
          certificate: "${FLEET_SERVER_CERT}"
          key: "${FLEET_SERVER_CERT_KEY}"
    cache:
      num_counters: 500000  # 10x times expected count
      max_cost: 50 * 1024 * 1024  # 50MiB cache size
  - id: fleet-server-fleet_server-355ad670-3f44-5a97-acbe-0ed8fa655332
    name: fleet_server-1
    revision: 1
    type: fleet-server
    use_output: default
    meta:
      package:
        name: fleet_server
        version: 1.2.0
    data_stream:
      namespace: default
    server:
      port: 8220
      host: 0.0.0.0

outputs:
  elasticsearch:
    hosts: 
      - "https://es01.${APP_ID}.${APP_NET}:9200"
      - "https://es02.${APP_ID}.${APP_NET}:9201"
      # - "https://es03.${APP_ID}.${APP_NET}:9202"
    protocol: "https"
    username: "${ELASTICSEARCH_USERNAME}"
    password: "${ELASTICSEARCH_PASSWORD}"
    #service_token: '${ELASTICSEARCH_SERVICE_TOKEN}'
    ssl:
      enabled: true
      certificate_authorities: ["${ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES}"]
      verification_mode: certificate
      # verification_mode: none
